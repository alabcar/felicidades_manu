<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manu</title>
    <style>
        /* --- RESET Y ESTRUCTURA --- */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: #f4f1ea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial Black', 'Helvetica Neue', Helvetica, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- TABLERO --- */
        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px; 
            background-color: #111;
            border: 4px solid #111;
            width: 95vmin;
            height: 95vmin;
            box-shadow: 10px 10px 0px rgba(210, 40, 40, 0.8); 
            position: relative;
        }

        /* --- CELDA --- */
        .grid-cell {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #fff;
            overflow: hidden; 
        }

        /* --- MENSAJES OCULTOS --- */
        .message-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5px;
            text-align: center;
            font-size: clamp(10px, 3.2vmin, 18px); 
            font-weight: 900;
            text-transform: uppercase;
            line-height: 1.1;
            color: #111;
            word-wrap: break-word;
            background-color: #f2c52c; 
            z-index: 0;
            /* Permitir clicks en el enlace cuando la foto no est√° */
            pointer-events: auto; 
        }

        /* Estilo para el bot√≥n del v√≠deo */
        .video-link {
            background-color: #d22828;
            color: white !important;
            padding: 10px 15px;
            text-decoration: none;
            border: 2px solid #000;
            margin-top: 5px;
            display: inline-block;
            font-size: 1.1em;
            box-shadow: 3px 3px 0px rgba(0,0,0,1);
            cursor: pointer;
            pointer-events: auto; /* Asegura que sea clickeable */
            z-index: 10;
        }
        
        .video-link:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px rgba(0,0,0,1);
        }

        /* Colores de fondo */
        #cell-0 .message-layer, #cell-8 .message-layer { background-color: #f2c52c; }
        #cell-1 .message-layer, #cell-7 .message-layer { background-color: #8fbcd4; }
        #cell-2 .message-layer, #cell-6 .message-layer { background-color: #e0e0e0; }
        #cell-3 .message-layer, #cell-5 .message-layer { background-color: #e85d4e; }

        /* --- MENSAJE CENTRAL --- */
        #cell-4 .message-layer {
            background-color: #fff;
            color: #d22828;
            border: none;
            font-size: clamp(12px, 4vmin, 22px);
            padding: 10px;
            z-index: 0;
        }

        /* --- FICHAS (FOTOS) --- */
        .tile {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
            z-index: 2;
            background-size: cover;
            background-position: center;
            background-color: #111; 
            border-radius: 0; 
            touch-action: none;
            transform: translate(0, 0) scale(1);
            transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .tile:active {
            cursor: grabbing;
        }

        .tile.dragging {
            z-index: 100 !important;
            transform: scale(1.05);
            box-shadow: 15px 15px 0px rgba(0,0,0,0.5); 
            transition: none;
            border: 2px solid #111; 
        }

        .tile.is-empty {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            z-index: -1;
        }

        /* --- EXPLOSI√ìN --- */
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 24px;
            z-index: 9999;
            font-family: "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }

        /* --- ASIGNACI√ìN DE FOTOS --- */
        .tile[data-id="1"] { background-image: url('foto1.jpg'); }
        .tile[data-id="2"] { background-image: url('foto2.jpg'); }
        .tile[data-id="3"] { background-image: url('foto3.jpg'); }
        .tile[data-id="4"] { background-image: url('foto4.jpg'); }
        .tile[data-id="6"] { background-image: url('foto5.jpg'); } 
        .tile[data-id="7"] { background-image: url('foto6.jpg'); }
        .tile[data-id="8"] { background-image: url('foto7.jpg'); }
        .tile[data-id="9"] { background-image: url('foto8.jpg'); }
    </style>
</head>
<body>

    <div id="game-board">
        <div class="grid-cell" id="cell-0">
            <div class="message-layer">Qu√© risa, eh.</div>
            <div class="tile" data-id="1"></div>
        </div>
        <div class="grid-cell" id="cell-1">
            <div class="message-layer">Alberto, ¬øser√≠as tan amable de invitarme a un cigarro?</div>
            <div class="tile" data-id="2"></div>
        </div>
        <div class="grid-cell" id="cell-2">
            <div class="message-layer">Me gustas pucho, me gustas pucho t√∫</div>
            <div class="tile" data-id="3"></div>
        </div>

        <div class="grid-cell" id="cell-3">
            <div class="message-layer">Hola, ¬øconoc√©is a mi amigo Alberto?</div>
            <div class="tile" data-id="4"></div>
        </div>
        
        <div class="grid-cell" id="cell-4">
            <div class="message-layer">
                Muchas felicidades, Manu,<br>de tu amigo Alberto
            </div>
            <div class="tile is-empty" data-id="5"></div>
        </div>

        <div class="grid-cell" id="cell-5">
            <div class="message-layer">Este es mi amigo Manu, ya os he hablado de √©l</div>
            <div class="tile" data-id="6"></div>
        </div>

        <div class="grid-cell" id="cell-6">
            <div class="message-layer">Amigas para siempre</div>
            <div class="tile" data-id="7"></div>
        </div>
        <div class="grid-cell" id="cell-7">
            <div class="message-layer">Cuc√∫</div>
            <div class="tile" data-id="8"></div>
        </div>
        <div class="grid-cell" id="cell-8">
            <div class="message-layer">Manu es el mejor</div>
            <div class="tile" data-id="9"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let emptyCellIndex = 4; 
            const tiles = document.querySelectorAll('.tile');
            
            let startX, startY, currentTile;
            let initialParentZIndex = '';

            // --- CONFIGURACI√ìN DE MENSAJES ---
            // El √≠ndice 0 es el ORIGINAL.
            // Los siguientes son pistas para buscar el enlace secreto.
            // El enlace secreto est√° SOLO en la casilla 8 (Abajo derecha).
            const phrasesDB = {
                0: [
                    "Qu√© risa, eh.", 
                    "Hay un secreto escondido...", 
                    "Sigue moviendo fichas.", 
                    "No est√° aqu√≠, busca m√°s."
                ],
                1: [
                    "Alberto, ¬øser√≠as tan amable de invitarme a un cigarro?", 
                    "El v√≠deo sorpresa no est√° aqu√≠.", 
                    "Prueba en las esquinas.", 
                    "Fr√≠o, fr√≠o..."
                ],
                2: [
                    "Me gustas pucho, me gustas pucho t√∫", 
                    "Sigue buscando el regalo.", 
                    "Mueve m√°s las fotos.", 
                    "Casi, pero no."
                ],
                3: [
                    "Hola, ¬øconoc√©is a mi amigo Alberto?", 
                    "Busca abajo a la derecha.", 
                    "El tesoro est√° cerca.", 
                    "Sigue jugando..."
                ],
                // 4 es centro (no cambia)
                5: [
                    "Este es mi amigo Manu, ya os he hablado de √©l", 
                    "Aqu√≠ no hay v√≠deo.", 
                    "Mira en la fila de abajo.", 
                    "Mueve esa ficha otra vez."
                ],
                6: [
                    "Amigas para siempre", 
                    "Est√°s muy cerca del v√≠deo.", 
                    "Caliente, caliente...", 
                    "No te rindas."
                ],
                7: [
                    "Cuc√∫", 
                    "¬°Mira a tu derecha!", 
                    "El v√≠deo est√° al lado.", 
                    "Una vez m√°s..."
                ],
                8: [
                    "Manu es el mejor", // Original
                    "¬°Casi lo tienes!", 
                    "¬°Sigue moviendo esta ficha!",
                    // EL ENLACE AL V√çDEO (aparece tras mover un par de veces esta ficha)
                    "¬°PREMIO!<br><a href='sorpresa.mp4' class='video-link'>VER V√çDEO ‚ñ∂</a>"
                ]
            };

            tiles.forEach(tile => {
                tile.addEventListener('mousedown', handleStart);
                tile.addEventListener('touchstart', handleStart, {passive: false});
            });

            function handleStart(e) {
                if (e.target.classList.contains('is-empty')) return;
                
                currentTile = e.target;
                initialParentZIndex = currentTile.parentElement.style.zIndex;
                currentTile.parentElement.style.zIndex = "1000";
                currentTile.classList.add('dragging');

                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    startX = e.clientX;
                    startY = e.clientY;
                    e.preventDefault(); 
                }

                document.addEventListener('mousemove', handleMove);
                document.addEventListener('mouseup', handleEnd);
                document.addEventListener('touchmove', handleMove, {passive: false});
                document.addEventListener('touchend', handleEnd);
            }

            function handleMove(e) {
                if (!currentTile) return;
                let clientX, clientY;
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                    e.preventDefault(); 
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                const diffX = clientX - startX;
                const diffY = clientY - startY;
                currentTile.style.transform = `translate(${diffX}px, ${diffY}px) scale(1.05)`;
            }

            function handleEnd(e) {
                document.removeEventListener('mousemove', handleMove);
                document.removeEventListener('mouseup', handleEnd);
                document.removeEventListener('touchmove', handleMove);
                document.removeEventListener('touchend', handleEnd);

                if (!currentTile) return;

                currentTile.classList.remove('dragging');
                currentTile.parentElement.style.zIndex = initialParentZIndex;
                currentTile.style.transform = '';

                const currentCell = currentTile.parentElement;
                const currentCellIndex = parseInt(currentCell.id.split('-')[1]);

                if (isAdjacent(currentCellIndex, emptyCellIndex)) {
                    let clientX, clientY;
                    if (e.changedTouches) { 
                        clientX = e.changedTouches[0].clientX;
                        clientY = e.changedTouches[0].clientY;
                    } else {
                        clientX = e.clientX;
                        clientY = e.clientY;
                    }

                    const diffX = clientX - startX;
                    const diffY = clientY - startY;
                    const dist = Math.sqrt(diffX*diffX + diffY*diffY);

                    if (dist < 10 || dist > 30) {
                        // IMPORTANTE: Actualizamos el mensaje del hueco que se va a tapar.
                        updateHiddenMessage(emptyCellIndex);
                        
                        swapTiles(currentCellIndex, emptyCellIndex);
                        const targetCell = document.getElementById(`cell-${emptyCellIndex}`);
                        explodeHearts(targetCell);
                    }
                }
                currentTile = null;
            }

            function isAdjacent(idx1, idx2) {
                const row1 = Math.floor(idx1 / 3);
                const col1 = idx1 % 3;
                const row2 = Math.floor(idx2 / 3);
                const col2 = idx2 % 3;
                return Math.abs(row1 - row2) + Math.abs(col1 - col2) === 1;
            }

            function swapTiles(clickedIndex, emptyIndex) {
                const clickedCell = document.getElementById(`cell-${clickedIndex}`);
                const emptyCell = document.getElementById(`cell-${emptyIndex}`);
                const clickedTile = clickedCell.querySelector('.tile');
                const emptyTile = emptyCell.querySelector('.tile');
                emptyCell.appendChild(clickedTile);
                clickedCell.appendChild(emptyTile);
                emptyCellIndex = clickedIndex;
            }

            function updateHiddenMessage(cellIndex) {
                if (cellIndex === 4) return;
                const phrases = phrasesDB[cellIndex];
                if (phrases) {
                    // Elegimos una frase aleatoria de la lista (evitando la primera que es la fija inicial si ya hemos empezado a jugar)
                    // Usamos Math.random() normal, esto significa que a veces saldr√° una pista y a veces (en la casilla 8) saldr√° el LINK.
                    // Para hacerlo m√°s divertido, usamos slice(1) para que ya no repita la original inicial, solo las nuevas pistas.
                    const newOptions = phrases.slice(1);
                    const randomPhrase = newOptions[Math.floor(Math.random() * newOptions.length)];
                    
                    const cell = document.getElementById(`cell-${cellIndex}`);
                    const msgLayer = cell.querySelector('.message-layer');
                    
                    setTimeout(() => { 
                        // Usamos innerHTML para que el enlace funcione
                        msgLayer.innerHTML = randomPhrase; 
                    }, 200);
                }
            }

            function explodeHearts(element) {
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const symbols = ['‚ù§Ô∏è', 'üíô', 'üíõ', 'üñ§']; 

                for (let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                    document.body.appendChild(particle);

                    const angle = Math.random() * Math.PI * 2; 
                    const velocity = 60 + Math.random() * 120; 
                    const tx = Math.cos(angle) * velocity;
                    const ty = Math.sin(angle) * velocity;
                    
                    const animation = particle.animate([
                        { transform: `translate(${centerX}px, ${centerY}px) scale(0)`, opacity: 1 },
                        { transform: `translate(${centerX + tx}px, ${centerY + ty}px) scale(1.5) rotate(${Math.random()*360}deg)`, opacity: 0 }
                    ], {
                        duration: 700 + Math.random() * 300, 
                        easing: 'cubic-bezier(0, .9, .57, 1)', 
                        fill: 'forwards'
                    });
                    animation.onfinish = () => particle.remove();
                }
            }
        });
    </script>
</body>
</html>